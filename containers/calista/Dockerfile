FROM dynverse/dynwrap:bioc

RUN R -e 'devtools::install_cran("destiny")'

RUN git clone https://github.com/CABSEL/CALISTA.git; rm -rf CALISTA/.git; find CALISTA -type f \( -iname \*.zip -o -iname \*.csv -o -iname \*.txt \) -exec rm {} +


RUN apt-get update

RUN apt-get install -y libcgal-dev libglu1-mesa-dev libglu1-mesa-dev libjpeg-dev libtiff-dev tcl-dev

RUN Rscript CALISTA/CALISTA-R/install_packs.R

ADD . /code

# Patch was generated by making changes in the calista git repository,
# and then running:
# git diff --no-prefix > ~/Workspace/dynverse/dynmethods/containers/calista/calista.patch

# patch CALISTA so it can work in a docker
RUN cd CALISTA; patch -p0 < /code/calista.patch; chmod +w -R .

ENTRYPOINT /code/run.sh
